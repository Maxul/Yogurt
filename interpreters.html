<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>JSON-RPC Demo for JQuery Terminal Emulator</title>
    <meta name="author" content="Jakub Jankiewicz - jcubic&#64;onet.pl"/>
    <meta name="Description" content="Demonstration for JQuery Terminal Emulator using call automaticly JSON-RPC service (in php) with authentication."/>
    <link rel="sitemap" type="application/xml" title="Sitemap" href=""/>
    <link rel="shortcut icon" href="favicon.ico"/>
    <script src="js/jquery-1.7.1.min.js"></script>
    <script src="js/jquery.mousewheel-min.js"></script>
    <script src="js/jquery.terminal.min.js"></script>
    
    <script src="lex.js"></script>
    <script src="parse.js"></script>
    <script src="eval.js"></script>
    <script src="keywords.js"></script>
    
    <link href="css/jquery.terminal.css" rel="stylesheet"/>
  </head>
<body>

<script>
var ul;
var empty = {
    options: [],
    args: []
};
var commands = {
    'get-command': {
        options: ['name', 'age', 'description', 'address'],
        args: ['clear']
    },
    'git': {
        args: ['commit', 'push', 'pull'],
        options: ['amend', 'hard', 'version', 'help']
    },
    'get-name': empty,
    'get-age': empty,
    'get-money': empty
};
var term = $('body').terminal($.noop, {
    onInit: function(term) {
        var wrapper = term.cmd().find('.cursor').wrap('<span/>').parent().addClass('cmd-wrapper');
        ul = $('<ul></ul>').appendTo(wrapper);
        ul.on('click', 'li', function() {
            term.insert($(this).text());
            ul.empty();
        });
    },
    keydown: function(e) {
        // setTimeout because terminal is adding characters in keypress
        // we use keydown because we need to prevent default action for tab and still execute custom code
        setTimeout(function() {
            ul.empty();
            var command = term.get_command();
            
            var name = command.match(/^([^\s]*)/)[0];
            if (name) {
                var word = term.before_cursor(true);
                var regex = new RegExp('^' + $.terminal.escape_regex(word));
                var list;
                
                if (name == word) {
                    list = Object.keys(commands);
                } else if (command.match(/\s/)) {
                    if (commands[name]) {
                        if (word.match(/^--/)) {
                            list = commands[name].options.map(function(option) {
                            
                                return '--' + option;
                            });
                        
                        } else {
                            list = commands[name].args;
                        }
                    }
                    
                }
                if (word.length >= 2 && list) {
                
                    var matched = [];
                    for (var i=list.length; i--;) {
                        if (regex.test(list[i])) {
                            matched.push(list[i]);
                        }
                    }
                    var insert = false;
                    if (e.which == 9) {
                        if (term.complete(matched)) {
                            word = term.before_cursor(true);
                            regex = new RegExp('^' + $.terminal.escape_regex(word));
                        }
                    }
                    if (matched.length) {
                        ul.hide();
                        for (var i=0; i<matched.length; ++i) {
                            //console.log(matched[i]);
                            $('<li>' + matched[i].replace(regex, '') + '</li>').appendTo(ul);
                        }
                        ul.show();
                    }
                }
            }
        }, 0);
        if (e.which == 9) {
            return false;
        }
        //term.echo(command);
    },
    onBlur: function() {
        return false;
    }
});

</script>
</body>
